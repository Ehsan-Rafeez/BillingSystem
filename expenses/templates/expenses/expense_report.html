{% extends 'core/base.html' %}
{% block title %}Expense Report{% endblock %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h2 class="mb-1">Expense Report</h2>
    <div class="text-muted">Filter by date and download.</div>
  </div>
  <a class="btn btn-outline-secondary" href="?{% if start %}start={{ start }}&{% endif %}{% if end %}end={{ end }}&{% endif %}download=csv">
    <i class="bi bi-download"></i> Download CSV
  </a>
</div>

<form class="row g-3 mb-3">
  <div class="col-md-3">
    <label class="form-label">Start date</label>
    <input type="date" name="start" class="form-control" value="{{ start }}">
  </div>
  <div class="col-md-3">
    <label class="form-label">End date</label>
    <input type="date" name="end" class="form-control" value="{{ end }}">
  </div>
  <div class="col-md-3">
    <label class="form-label">Category</label>
    <select name="category" class="form-select">
      <option value="">All</option>
      {% for cat in categories %}
        <option value="{{ cat.id }}" {% if selected_category == cat.id|stringformat:'s' %}selected{% endif %}>{{ cat.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2 align-self-end">
    <button class="btn btn-primary w-100" type="submit"><i class="bi bi-funnel"></i> Apply</button>
  </div>
</form>

<div class="mb-3">
  <strong>Total:</strong> PKR {{ total|floatformat:2 }}
</div>

<div class="card shadow-sm">
  <div class="card-body table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Date</th>
          <th>Category</th>
          <th>Description</th>
          <th>Amount</th>
          <th>Supplier</th>
          <th>Reference</th>
          <th>Method</th>
        </tr>
      </thead>
      <tbody>
        {% for exp in rows %}
          <tr>
            <td>{{ exp.date }}</td>
            <td>{{ exp.category }}</td>
            <td>{{ exp.description }}</td>
            <td>PKR {{ exp.amount }}</td>
            <td>{{ exp.supplier_name|default:"-" }}</td>
            <td>{{ exp.reference|default:"-" }}</td>
            <td>{{ exp.get_payment_method_display }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="7" class="text-center text-muted">No data for this range.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
